<h1>接入流程FAQ</h1>

### 1.SDK接入FAQ

Q1.1:接入过程中遇到问题，如何联系我们？  
A1.1:请详细阅读下面的FAQ，接入过程中常见的问题我们都给出了解答。
如果仍有问题，可以通过运营建立的QQ群进行询问。  

Q1.2:如何申请appid和serverid等平台参数？  
A1.2:请发邮件给运营人员申请

Q1.3:如何配置充值回调地址  
A3:请发邮件给运营人员申请  

Q1.4:app secret可以保存在手机本地吗？  
A1.4:不要这样来做，建议游戏开发者自己搭建服务器，将app secret保存起来

Q1.5:so库如何选择  
A1.5:拷贝libs下的so文件时，请根据游戏具体编译情况导入。比如unity默认的FAT（ARMv7 + x86）,则复制armeabi-v7a和x86的so即可，Cocos2dx查看设置的APP_ABI如果默认不设置则拷贝armeabi或者查看编译出自己的so库有哪几种类型就拷贝对应类型的so。PS：所有类型的so文件可以在sdk包的接入内容的so文件夹中找到

Q1.6:哪些接口是必须接入的    
A6: init、login、createRole、notifyZone、pay、setAccountListener

接口名称 | 接口说明
---|---
init | 初始化SDK的接口
login | 登录接口，登录成功后返回用户信息
createRole | 创角接口，游戏新用户第一次登录后调用
notifyZone | 通知区服，每次登录只能调用一次(多次会审核失败)，建议在登录、创角角色(游戏新用户)之后调用
pay|支付接口，客户端的支付结果仅作为参考，真实结果请以服务器结果为准

Q1.7:游戏在游戏中心上架前是否会进行重签名？  
A1.7:我方会进行重签名，所以如果游戏有微信登录、微信分享、签名保护功能。需要签名MD5或签名测试包发邮件给运营人员申请  

Q1.8:Android Studio如何接入SDK   
A1.8:此部分请查看SDK zip包中的说明，请注意使用我方提供的混淆规则
	
Q1.9:游戏方进行打包时targetSDKVersion应该为多少？   
A1.9:建议23以下

Q1.10:接入SDK时发现第三方库重复，如何解决？  
A1.10:当发现SDK中使用的第三方库与游戏方使用的第三方库重复时游戏方需删除自己项目中的第三方库使用SDK中的第三方库

Q1.11:旧版的Unity该如何接入SDK   
A1.11:请参考`接入内容/BSGameSdk_U3D/u3d接入说明`

### 2.登录注册相关FAQ

Q2.1:授权登录成功后游戏重启原因？  
A2.1:

* 授权登录界面是竖屏的全屏，会导致游戏生命周期发生变化，游戏开发人员查看onStop之后游戏是否会重启
* 之前遇到的新用户在游戏视频的启动页点击，进行授权登录发生游戏重启，游戏开发人员查看游戏视频播放逻辑

Q2.2:授权登录、一键登录、自动登录是什么含义？  
A2.2:   

* 授权登录：手机安装Bili客户端并且登录Bili账号下，之前用户未登录过游戏账号，游戏客户端调用login接口出现授权登录  
* 一键登录和自动登录：这两种登录是一样的，
都是用户第一次登录成功后，第二次会自动登录，不需要输入账号和密码

Q2.3:游戏登录验证失败的怎么排查？  
A2.3:登录验证失败属于游戏服务器到平台服务器验证用户信息失败会出现这种问题，具体排查方式如下： 

* 分析游戏服务器请求session.verfy接口平台服务器返回结果，如果属于参数错误则检查签名和游戏参数是否配置正确；如果返回accesskey错误可以联系平台服务器人员查看原因  
* 如果游戏服务器请求session.verfy接口正常，但是游戏客户端提示验证失败，游戏客户端人员查看请求超时时间，以及请求服务器返回的时间，是否超时导致的，如果是超时导致的，请查看游戏服务器请求平台服务器返回时间和游戏服务器返给游戏客户端时间进行分析

Q2.4:注册账号或者游客登录的时候提示服务器内部错误   
A2.4:当前ip注册次数超过限制，请过一段时间再进行尝试或者切换4G网络测试

Q2.5:登录或者注册时提示"无效的API签名"   
A2.5:请检查初始化SDK的时相关参数是否正确 

### 3.支付相关FAQ

Q3.1:调用支付接口(pay)支付失败的原因？  
A3.1:
* 当游戏客户端进行支付时传入的uid与SDK本地存储的uid不同时SDK会返回7005的error code
* 当游戏客户端在支付之前没有调用过notifyZone接口

Q3.2:游戏的支付方式为什么没有微信支付？  
A3.2:微信支付发邮件给运营人员，审批之后会开通

Q3.3:微信支付注意点有哪些？  
A3.3:

* 在游戏package下新建wxapi文件夹，然后新建
WXPayEntryActivity，并且WXPayEntryActivity继承SDK中的BaseWXEntryActivity，WXPayEntryActivity不需要实现任何方法。
* 在AndroidManifest.xml声明

```
<activity
    android:name=".wxapi.WXPayEntryActivity"
    android:exported="true"
    android:launchMode="singleTop" />  
```
* SDK的包含了微信SDK的支付和分享等模块，如果游戏要使用分享功能，无须再接入微信的SDK；  
* 平台会进行二次签名，如果游戏包含微信分享，在微信后台配置的签名需要为平台正式签名后的；

Q3.4:调用支付接口提示"服务器返回数据异常"   
A3.4:请检查

* 登录后是否调用过通知区服接口，并且参数正确
* 支付接口相关参数是否正确并且不为空
* 确认网络是否畅通

Q3.5:支付接口的参数是游戏的还是平台的？   
A3.5:

* uid使用平台的唯一标识,由登录接口返回
* username使用平台的用户名,由登录接口返回
* serverid使用平台提供的服务器id
* role使用游戏自身的信息

### 4.创角与通知区服接口相关FAQ

Q4.1:创角接口(createRole)的参数是游戏的还是平台的？  
A4.1:role和role_id均为游戏的角色名和角色id    
> 如果游戏设定没有创角则需要发邮件给运营确认，运营确认后role可以固定一个，但是role\_id必须是唯一的，role和role\_id不能为空

Q4.2:通知区服接口(notifyZone)参数是游戏的还是平台的？  
A4.2:

* server\_id和server\_name是平台分配的；role\_id和role\_name跟创角接口的内容一样的  
* 支付接口依赖notifyZone接口，所以建议notifyZone接口在登录、创角、选择区服后调用
* notifyZone每次登录之后只需要调用一次

Q4.3:如何查单接口的请求、接口是否调用？   
A4.3:游戏方可以通过charles抓网络请求来判断请求参数是否正确以及接口调用手机是否正确
	
### 5.其他FAQ

Q5.1:自检工具的使用  
A5.1:游戏提包之前必须先使用自检工具检测，检测内容无误后再提包测试，[自检工具使用说明](https://pkg.biligame.com/tool/%E8%87%AA%E6%A3%80%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E.pdf)

Q5.2:游戏包正式签名后启动失败的原因？  
A5.2:

* 游戏开发人员确保提测的游戏包没有加固过
* 游戏开发人员确保游戏内没有对包的签名进行校验(如果有校验则需要是平台签名后的数据)

如果联系平台开发人员请准备好以下内容  

* 用户的B站UID  
* 游戏服务器请求平台服务器的日志

